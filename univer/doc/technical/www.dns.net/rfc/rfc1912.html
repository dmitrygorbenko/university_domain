<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
   <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
   <META NAME="GENERATOR" CONTENT="Mozilla/4.5b2 [en] (WinNT; I) [Netscape]">
   <META NAME="Author" CONTENT="Mark Symons (bliksim9@yahoo.com)">
   <TITLE>RFC1912: Common DNS Operational and Configuration Errors</TITLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFFF" LINK="#0000EE" VLINK="#551A8B" ALINK="#FF0000">
This RFC has been
HTMLized by hand by <A HREF="mailto:bliksim9@yahoo.com">Mark Symons</A>,
and word-for-word correspondance to the source has not been
<BR>verified.&nbsp; A table of contents has been added. The <A HREF="ftp://ftp.is.co.za/rfc/rfc1912.txt">original
RFC</A> should be regarded as being authoritative.
<BR>
<HR WIDTH="100%">
<BR>&nbsp;
<BR>&nbsp;
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0 COLS=3 WIDTH="100%" >
<TR>
<TD>Network Working Group</TD>

<TD></TD>

<TD>D. Barr</TD>
</TR>

<TR>
<TD>Request for Comments: 1912&nbsp;</TD>

<TD></TD>

<TD>The Pennsylvania State University</TD>
</TR>

<TR>
<TD>Obsoletes: <A HREF="ftp://ftp.is.co.za/rfc/rfc1537.txt">1537</A></TD>

<TD></TD>

<TD>February 1996</TD>
</TR>

<TR>
<TD>Category: Informational</TD>

<TD></TD>

<TD></TD>
</TR>
</TABLE>

<H1>
Common DNS Operational and Configuration Errors</H1>

<H2>
Status of this Memo</H2>
This memo provides information for the Internet community.&nbsp; This memo
does not specify an Internet standard of any kind.&nbsp; Distribution of
this memo is unlimited.
<BR>&nbsp;
<H2>
Abstract</H2>
This memo describes errors often found in both the operation of Domain
Name System (DNS) servers, and in the data that these DNS servers contain.&nbsp;
This memo tries to summarize current Internet requirements as well as common
practice in the operation and configuration of the DNS.&nbsp; This memo
also tries to summarize or expand upon issues raised in [<A HREF="ftp://ftp.is.co.za/rfc/rfc1537.txt">RFC
1537</A>].
<BR>&nbsp;
<H2>
Contents</H2>
<B><A HREF="#1.Introduction">1.&nbsp; Introduction</A></B>
<BR><B><A HREF="#2.DNS Data">2.&nbsp; DNS Data</A></B>
<BR>&nbsp;&nbsp;&nbsp;&nbsp; <A HREF="#2.1 Inconsistent">2.1 Inconsistent,
Missing, or Bad Data</A>
<BR>&nbsp;&nbsp;&nbsp;&nbsp; <A HREF="#2.2 SOA records">2.2 SOA Records</A>
<BR>&nbsp;&nbsp;&nbsp;&nbsp; <A HREF="#2.3 Glue A Records">2.3 Glue A Records</A>
<BR>&nbsp;&nbsp;&nbsp;&nbsp; <A HREF="#2.4 CNAME">2.4 CNAME Records</A>
<BR>&nbsp;&nbsp;&nbsp;&nbsp; <A HREF="#2.5 MX">2.5 MX Records</A>
<BR>&nbsp;&nbsp;&nbsp;&nbsp; <A HREF="#2.6 Other Resource">2.6 Other Resource
Records</A>
<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A HREF="#2.6.1 WKS">2.6.1
WKS</A>
<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A HREF="#2.6.2 HINFO">2.6.2
HINFO</A>
<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A HREF="#2.6.3 TXT">2.6.3
TXT</A>
<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A HREF="#2.6.4 RP">2.6.4
RP</A>
<BR>&nbsp;&nbsp;&nbsp;&nbsp; <A HREF="#2.7 Wildcard">2.7 Wildcard Records</A>
<BR>&nbsp;&nbsp;&nbsp;&nbsp; <A HREF="#2.8 Authority">2.8 Authority and
Delegation Errors (NS records)</A>
<BR><B><A HREF="#3. BIND">3.&nbsp; BIND Operation</A></B>
<BR>&nbsp;&nbsp;&nbsp;&nbsp; <A HREF="#3.1 Serial">3.1 Serial Numbers</A>
<BR>&nbsp;&nbsp;&nbsp;&nbsp; <A HREF="#3.2 Zone file style">3.2 Zone File
Style Guide</A>
<BR>&nbsp;&nbsp;&nbsp;&nbsp; <A HREF="#3.3 Verifying">3.3 Verifying Data</A>
<BR><B><A HREF="#4. Miscellaneous">4.&nbsp; Miscellaneous Topics</A></B>
<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A HREF="#4.1 Boot file">4.1 Boot File
Setup</A>
<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A HREF="#4.2 Other Resolver">4.2 Other
Resolver And Server Bugs</A>
<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <A HREF="#4.3 Server">4.3 Server Issues</A>
<BR><B><A HREF="#References">References</A></B>
<BR><B><A HREF="#5. Security">5.&nbsp; Security Considerations</A></B>
<BR><B><A HREF="#6. Author">6.&nbsp; Author's Address</A></B>
<H2>
<A NAME="1.Introduction"></A>1. Introduction</H2>
Running a nameserver is not a trivial task.&nbsp; There are many things
that can go wrong, and many decisions have to be made about what data to
put in the DNS and how to set up servers.&nbsp; This memo attempts to address
many of the common mistakes and pitfalls that are made in DNS data as well
as in the operation of nameservers.&nbsp; Discussions are also made regarding
some other relevant issues such as server or resolver bugs, and a few political
issues with respect to the operation of DNS on the Internet.
<H2>
<A NAME="2.DNS Data"></A>2. DNS Data</H2>
This section discusses problems people typically have with the DNS data
in their nameserver, as found in the zone data files that the nameserver
loads into memory.
<BR>&nbsp;
<H3>
<A NAME="2.1 Inconsistent"></A>2.1 Inconsistent, Missing, or Bad Data</H3>
Every Internet-reachable host should have a name.&nbsp; The consequences
of this are becoming more and more obvious.&nbsp; Many services available
on the Internet will not talk to you if you aren't correctly registered
in the DNS.
<P>Make sure your PTR and A records match.&nbsp; For every IP address,
there should be a matching PTR record in the in-addr.arpa domain.&nbsp;
If a host is multi-homed, (more than one IP address) make sure that all
IP addresses have a corresponding PTR record (not just the first one).
Failure to have matching PTR and A records can cause loss of Internet services
similar to not being registered in the DNS at all.&nbsp; Also, PTR records
must point back to a valid A record, not a alias defined by a CNAME.&nbsp;
It is highly recommended that you use some software which automates this
checking, or generate your DNS data from a database which automatically
creates consistent data.
<P>DNS domain names consist of "labels" separated by single dots.&nbsp;
The DNS is very liberal in its rules for the allowable characters in a
domain name.&nbsp; However, if a domain name is used to name a host, it
should follow rules restricting host names.&nbsp; Further if a name is
used for mail, it must follow the naming rules for names in mail addresses.
<P>Allowable characters in a label for a host name are only ASCII letters,
digits, and the `-' character.&nbsp; Labels may not be all numbers, but
may have a leading digit&nbsp; (e.g., 3com.com).&nbsp; Labels must end
and begin only with a letter or digit.&nbsp; See [<A HREF="rfc1035/rfc1035.html">RFC
1035</A>] and [<A HREF="ftp://ftp.is.co.za/rfc/rfc1123.txt">RFC 1123</A>].&nbsp;
(Labels were initially restricted in [<A HREF="rfc1035/rfc1035.html">RFC
1035</A>] to start with a letter, and some older hosts still reportedly
have problems with the relaxation in [<A HREF="ftp://ftp.is.co.za/rfc/rfc1123.txt">RFC
1123</A>].)&nbsp; Note there are some Internet hostnames which violate
this rule (411.org, 1776.com).&nbsp; The presence of underscores in a label
is allowed in [<A HREF="ftp://ftp.is.co.za/rfc/rfc1033.txt">RFC 1033</A>],
except [<A HREF="ftp://ftp.is.co.za/rfc/rfc1033.txt">RFC 1033</A>] is informational
only and was not defining a standard.&nbsp; There is at least one popular
TCP/IP implementation which currently refuses to talk to hosts named with
underscores in them.&nbsp; It must be noted that the language in [<A HREF="rfc1035/rfc1035.html">1035</A>]
is such that these rules are voluntary - they are there for those who wish
to minimize problems.&nbsp; Note that the rules for Internet host names
also apply to hosts and addresses used in SMTP (See <A HREF="ftp://ftp.is.co.za/rfc/rfc821.txt">RFC
821</A>).
<P>If a domain name is to be used for mail (not involving SMTP), it must
follow the rules for mail in [<A HREF="ftp://ftp.is.co.za/rfc/rfc822.txt">RFC
822</A>], which is actually more liberal than the above rules.&nbsp; Labels
for mail can be any ASCII character except "specials", control characters,
and whitespace characters.&nbsp; "Specials" are specific symbols used in
the parsing of addresses.&nbsp; They are the characters "()&lt;>@,;:\".[]".&nbsp;
(The "!" character wasn't in [<A HREF="ftp://ftp.is.co.za/rfc/rfc822.txt">RFC
822</A>], however it also shouldn't be used due to the conflict with UUCP
mail as defined in <A HREF="ftp://ftp.is.co.za/rfc/rfc976.txt">RFC 976</A>)&nbsp;
However, since today almost all names which are used for mail on the Internet
are also names used for hostnames, one rarely sees addresses using these
relaxed standard, but mail software should be made liberal and robust
<BR>enough to accept them.
<P>You should also be careful to not have addresses which are valid alternate
syntaxes to the inet_ntoa() library call.&nbsp; For example 0xe is a valid
name, but if you were to type "telnet 0xe", it would try to connect to
IP address 0.0.0.14.&nbsp; It is also rumored that there exists some broken
inet_ntoa() routines that treat an address like x400 as an IP address.
<P>Certain operating systems have limitations on the length of their own
hostname.&nbsp; While not strictly of issue to the DNS, you should be aware
of your operating system's length limits before choosing the name of a
host.
<P>Remember that many resource records (abbreviated RR) take on more than
one argument.&nbsp; HINFO requires two arguments, as does RP.&nbsp; If
you don't supply enough arguments, servers sometime return garbage for
the missing fields.&nbsp; If you need to include whitespace within any
data, you must put the string in quotes.
<BR>&nbsp;
<H3>
<A NAME="2.2 SOA records"></A>2.2 SOA records</H3>
In the SOA record of every zone, remember to fill in the e-mail address
that will get to the person who maintains the DNS at your site (commonly
referred to as "hostmaster").&nbsp; The `@' in the e-mail must be replaced
by a `.' first.&nbsp; Do not try to put an `@' sign in this address.&nbsp;
If the local part of the address already contains a `.' (e.g., John.Smith@widget.xx),
then you need to quote the `.' by preceding it with `\' character.&nbsp;
(e.g., to become John\.Smith.widget.xx) Alternately (and preferred), you
can just use the generic name `hostmaster', and use a mail alias to redirect
it to the appropriate persons.&nbsp; There exists software which uses this
field to automatically generate the e-mail address for the zone contact.
This software will break if this field is improperly formatted.&nbsp; It
is imperative that this address get to one or more real persons, because
it is often used for everything from reporting bad DNS data to reporting
security incidents.
<P>Even though some BIND versions allow you to use a decimal in a serial
number, don't.&nbsp; A decimal serial number is converted to an unsigned
32-bit integer internally anyway.&nbsp; The formula for a n.m serial number
is n*10^(3+int(0.9+log10(m))) + m which translates to something rather
unexpected.&nbsp; For example it's routinely possible with a decimal serial
number (perhaps automatically generated by SCCS) to be incremented such
that it is numerically larger, but after the above conversion yield a serial
number which is LOWER than before.&nbsp; Decimal serial numbers have been
officially deprecated in recent BIND versions.&nbsp; The recommended syntax
is YYYYMMDDnn (YYYY=year, MM=month, DD=day, nn=revision number.&nbsp; This
won't overflow until the year 4294.
<P>Choose logical values for the timer values in the SOA record (note values
below must be expressed as seconds in the zone data):
<UL><B>Refresh</B>: How often a secondary will poll the primary server
to see if the serial number for the zone has increased (so it knows to
request a new copy of the data for the zone).&nbsp; Set this to how long
your secondaries can comfortably contain out-of-date data.&nbsp; You can
keep it short (20 mins to 2 hours) if you aren't worried about a small
increase in bandwidth used, or longer (2-12 hours) if your Internet connection
is slow or is started on demand.&nbsp; Recent BIND versions (4.9.3) have
optional code to automatically notify secondaries that data has changed,
allowing you to set this TTL to a long value (one day, or more).</UL>

<UL><B>Retry</B>: If a secondary was unable to contact the primary at the
last refresh, wait the retry value before trying again.&nbsp; This value
isn't as important as others, unless the secondary is on a distant network
from the primary or the primary is more prone to outages.&nbsp; It's typically
some fraction of the refresh interval.
<P><B>Expire</B>: How long a secondary will still treat its copy of the
zone data as valid if it can't contact the primary.&nbsp; This value should
be greater than how long a major outage would typically last, and must
be greater than the minimum and retry intervals, to avoid having a secondary
expire the data before it gets a chance to get a new copy.&nbsp; After
a zone is expired a secondary will still continue to try to contact the
primary, but it will no longer provide nameservice for the zone.&nbsp;
2-4 weeks are suggested values.
<P><B>Minimum</B>: The default TTL (time-to-live) for resource records
- how long data will remain in other nameservers' cache.&nbsp; ([<A HREF="rfc1035/rfc1035.html">RFC
1035</A>] defines this to be the minimum value, but servers seem to always
implement this as the default value)&nbsp; This is by far the most important
timer.&nbsp; Set this as large as is comfortable given how often you update
your nameserver.&nbsp; If you plan to make major changes, it's a good idea
to turn this value down temporarily beforehand.&nbsp; Then wait the previous
minimum value, make your changes, verify their correctness, and turn this
value back up.&nbsp; 1-5 days are typical values.&nbsp; Remember this value
can be overridden on individual resource records.</UL>

<P><BR>As you can see, the typical values above for the timers vary widely.
Popular documentation like [<A HREF="ftp://ftp.is.co.za/rfc/rfc1033.txt">RFC
1033</A>] recommended a day for the minimum TTL, which is now considered
too low except for zones with data that vary regularly.&nbsp; Once a DNS
stabilizes, values on the order of 3 or more days are recommended.&nbsp;
It is also recommended that you individually override the TTL on certain
RRs which are often referenced and don't often change to have very large
values (1-2 weeks).&nbsp; Good examples of this are the MX, A, and PTR
records of your mail host(s), the NS records of your zone, and the A records
of your nameservers.
<BR>&nbsp;
<H3>
<A NAME="2.3 Glue A Records"></A>2.3 Glue A Records</H3>
Glue records are A records that are associated with NS records to provide
"bootstrapping" information to the nameserver.&nbsp; For example:
<BR>&nbsp;
<BR>&nbsp;
<CENTER><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0 COLS=4 WIDTH="75%" >
<TR>
<TD>podunk.xx.</TD>

<TD>in</TD>

<TD>ns</TD>

<TD>ns1.podunk.xx.</TD>
</TR>

<TR>
<TD></TD>

<TD>in</TD>

<TD>ns</TD>

<TD>ns2.podunk.xx.</TD>
</TR>

<TR>
<TD>ns1.podunk.xx.</TD>

<TD>in</TD>

<TD>a</TD>

<TD>1.2.3.4</TD>
</TR>

<TR>
<TD>ns2.podunk.xx.</TD>

<TD>in</TD>

<TD>a</TD>

<TD>1.2.3.5</TD>
</TR>
</TABLE></CENTER>

<P>Here, the A records are referred to as "Glue records".
<P>Glue records are required only in forward zone files for nameservers
that are located in the subdomain of the current zone that is being delegated.&nbsp;
You shouldn't have any A records in an in-addr.arpa zone file (unless you're
using <A HREF="ftp://ftp.is.co.za/rfc/rfc1011.txt">RFC 1101</A>-style encoding
of subnet masks).
<P>If your nameserver is multi-homed (has more than one IP address), you
must list all of its addresses in the glue to avoid cache inconsistency
due to differing TTL values, causing some lookups to not find all addresses
for your nameserver.
<P>Some people get in the bad habit of putting in a glue record whenever
they add an NS record "just to make sure".&nbsp; Having duplicate glue
records in your zone files just makes it harder when a nameserver moves
to a new IP address, or is removed. You'll spend hours trying to figure
out why random people still see the old IP address for some host, because
someone forgot to change or remove a glue record in some other file.&nbsp;
Newer BIND versions will ignore these extra glue records in local zone
files.
<P>Older BIND versions (4.8.3 and previous) have a problem where it inserts
these extra glue records in the zone transfer data to secondaries.&nbsp;
If one of these glues is wrong, the error can be propagated to other nameservers.&nbsp;
If two nameservers are secondaries for other zones of each other, it's
possible for one to continually pass old glue records back to the other.&nbsp;
The only way to get rid of the old data is to kill both of them, remove
the saved backup files, and restart them.&nbsp; Combined with that those
same versions also tend to become infected more easily with bogus data
found in other non-secondary nameservers (like the root zone data).
<BR>&nbsp;
<H3>
<A NAME="2.4 CNAME"></A>2.4 CNAME records</H3>
A CNAME record is not allowed to coexist with any other data.&nbsp; In
other words, if suzy.podunk.xx is an alias for sue.podunk.xx, you can't
also have an MX record for suzy.podunk.edu, or an A record, or even a TXT
record.&nbsp; Especially do not try to combine CNAMEs and NS records like
this!:
<BR>&nbsp;
<BR>&nbsp;
<CENTER><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0 COLS=4 WIDTH="75%" >
<TR>
<TD>podunk.xx.</TD>

<TD>IN</TD>

<TD>NS</TD>

<TD>ns1</TD>
</TR>

<TR>
<TD></TD>

<TD>IN</TD>

<TD>NS</TD>

<TD>ns2</TD>
</TR>

<TR>
<TD></TD>

<TD>IN</TD>

<TD>CNAME</TD>

<TD>mary</TD>
</TR>

<TR>
<TD>mary</TD>

<TD>IN</TD>

<TD>A</TD>

<TD>1.2.3.4</TD>
</TR>
</TABLE></CENTER>

<P>This is often attempted by inexperienced administrators as an obvious
way to allow your domain name to also be a host.&nbsp; However, DNS servers
like BIND will see the CNAME and refuse to add any other resources for
that name.&nbsp; Since no other records are allowed to coexist with a CNAME,
the NS entries are ignored.&nbsp; Therefore all the hosts in the podunk.xx
domain are ignored as well!
<P>If you want to have your domain also be a host, do the following:
<BR>&nbsp;
<BR>&nbsp;
<CENTER><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0 COLS=4 WIDTH="75%" >
<TR>
<TD>podunk.xx.</TD>

<TD>IN</TD>

<TD>NS</TD>

<TD>ns1</TD>
</TR>

<TR>
<TD></TD>

<TD>IN</TD>

<TD>NS</TD>

<TD>ns2</TD>
</TR>

<TR>
<TD></TD>

<TD>IN</TD>

<TD>A</TD>

<TD>1.2.3.4</TD>
</TR>

<TR>
<TD>mary</TD>

<TD>IN</TD>

<TD>A</TD>

<TD>1.2.3.4</TD>
</TR>
</TABLE></CENTER>

<P>Don't go overboard with CNAMEs.&nbsp; Use them when renaming hosts,
but plan to get rid of them (and inform your users).&nbsp; However CNAMEs
are useful (and encouraged) for generalized names for servers - `ftp' for
your ftp server, `www' for your Web server, `gopher' for your Gopher server,
`news' for your Usenet news server, etc.
<P>Don't forget to delete the CNAMEs associated with a host if you delete
the host it is an alias for.&nbsp; Such "stale CNAMEs" are a waste of resources.
<P>Don't use CNAMEs in combination with RRs which point to other names
like MX, CNAME, PTR and NS.&nbsp; (PTR is an exception if you want to implement
classless in-addr delegation.)&nbsp; For example, this is strongly discouraged:
<BR>&nbsp;
<BR>&nbsp;
<CENTER><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0 COLS=4 WIDTH="75%" >
<TR>
<TD>podunk.xx.</TD>

<TD>IN</TD>

<TD>MX</TD>

<TD>mailhost</TD>
</TR>

<TR>
<TD>mailhost</TD>

<TD>IN</TD>

<TD>CNAME</TD>

<TD>mary</TD>
</TR>

<TR>
<TD>mary</TD>

<TD>IN</TD>

<TD>A</TD>

<TD>1.2.3.4</TD>
</TR>
</TABLE></CENTER>

<P>[<A HREF="ftp://ftp.is.co.za/rfc/rfc1034.txt">RFC 1034</A>] in section
3.6.2 says this should not be done, and [<A HREF="ftp://ftp.is.co.za/rfc/rfc974.txt">RFC
974</A>] explicitly states that MX records shall not point to an alias
defined by a CNAME.&nbsp; This results in unnecessary indirection in accessing
the data, and DNS resolvers and servers need to work more to get the answer.&nbsp;
If you really want to do this, you can accomplish the same thing by using
a preprocessor such as m4 on your host files.
<P>Also, having chained records such as CNAMEs pointing to CNAMEs may make
administration issues easier, but is known to tickle bugs in some resolvers
that fail to check loops correctly.&nbsp; As a result some hosts may not
be able to resolve such names.
<P>Having NS records pointing to a CNAME is bad and may conflict badly
with current BIND servers.&nbsp; In fact, current BIND implementations
will ignore such records, possibly leading to a lame delegation. There
is a certain amount of security checking done in BIND to prevent spoofing
DNS NS records.&nbsp; Also, older BIND servers reportedly will get caught
in an infinite query loop trying to figure out the address for the aliased
nameserver, causing a continuous stream of DNS requests to be sent.
<BR>&nbsp;
<H3>
<A NAME="2.5 MX"></A>2.5 MX records</H3>
It is a good idea to give every host an MX record, even if it points to
itself!&nbsp; Some mailers will cache MX records, but will always need
to check for an MX before sending mail.&nbsp; If a site does not have an
MX, then every piece of mail may result in one more resolver query, since
the answer to the MX query often also contains the IP addresses of the
MX hosts.&nbsp; Internet SMTP mailers are required by [<A HREF="ftp://ftp.is.co.za/rfc/rfc1123.txt">RFC
1123</A>] to support the MX mechanism.
<P>Put MX records even on hosts that aren't intended to send or receive
e-mail.&nbsp; If there is a security problem involving one of these hosts,
some people will mistakenly send mail to postmaster or root at the site
without checking first to see if it is a "real" host or just a terminal
or personal computer that's not set up to accept e-mail.&nbsp; If you give
it an MX record, then the e-mail can be redirected to a real person.&nbsp;
Otherwise mail can just sit in a queue for hours or days until the mailer
gives up trying to send it.
<P>Don't forget that whenever you add an MX record, you need to inform
the target mailer if it is to treat the first host as "local".&nbsp; (The
"Cw" flag in sendmail, for example)
<P>If you add an MX record which points to an external host (e.g., for
the purposes of backup mail routing) be sure to ask permission from that
site first.&nbsp; Otherwise that site could get rather upset and take action
(like throw your mail away, or appeal to higher authorities like your parent
DNS administrator or network provider.)
<BR>&nbsp;
<H3>
<A NAME="2.6 Other Resource"></A>2.6 Other Resource Records</H3>

<H4>
<A NAME="2.6.1 WKS"></A>2.6.1 WKS</H4>
WKS records are deprecated in [<A HREF="ftp://ftp.is.co.za/rfc/rfc1123.txt">RFC
1123</A>].&nbsp; They serve no known useful function, except internally
among LISP machines.&nbsp; Don't use them.
<BR>&nbsp;
<H4>
<A NAME="2.6.2 HINFO"></A>2.6.2 HINFO</H4>
On the issue HINFO records, some will argue that these is a security problem
(by broadcasting what vendor hardware and operating system you so people
can run systematic attacks on known vendor security holes).&nbsp; If you
do use them, you should keep up to date with known vendor security problems.&nbsp;
However, they serve a useful purpose. Don't forget that HINFO requires
two arguments, the hardware type, and the operating system.
<P>HINFO is sometimes abused to provide other information.&nbsp; The record
is meant to provide specific information about the machine itself. If you
need to express other information about the host in the DNS, use TXT.
<BR>&nbsp;
<H4>
<A NAME="2.6.3 TXT"></A>2.6.3 TXT</H4>
TXT records have no specific definition.&nbsp; You can put most anything
in them.&nbsp; Some use it for a generic description of the host, some
put specific information like its location, primary user, or maybe even
a phone number.
<BR>&nbsp;
<H4>
<A NAME="2.6.4 RP"></A>2.6.4 RP</H4>
RP records are relatively new.&nbsp; They are used to specify an e-mail
address (see first paragraph of section 2.2)&nbsp; of the "Responsible
Person" of the host, and the name of a TXT record where you can get more
information.&nbsp; See [<A HREF="ftp://ftp.is.co.za/rfc/rfc1183.txt">RFC
1183</A>].
<BR>&nbsp;
<H3>
<A NAME="2.7 Wildcard"></A>2.7 Wildcard records</H3>
Wildcard MXs are useful mostly for non IP-connected sites.&nbsp; A common
mistake is thinking that a wildcard MX for a zone will apply to all hosts
in the zone.&nbsp; A wildcard MX will apply only to names in the zone which
aren't listed in the DNS at all.&nbsp; e.g.,
<BR>&nbsp;
<BR>&nbsp;
<CENTER><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0 COLS=4 WIDTH="75%" >
<TR>
<TD>podunk.xx.</TD>

<TD>IN</TD>

<TD>NS</TD>

<TD>ns1</TD>
</TR>

<TR>
<TD></TD>

<TD>IN</TD>

<TD>NS</TD>

<TD>ns2</TD>
</TR>

<TR>
<TD>mary</TD>

<TD>IN</TD>

<TD>A</TD>

<TD>1.2.3.4</TD>
</TR>

<TR>
<TD>*.podunk.xx.</TD>

<TD>IN</TD>

<TD>MX</TD>

<TD>5&nbsp;&nbsp; sue</TD>
</TR>
</TABLE></CENTER>

<P>Mail for mary.podunk.xx will be sent to itself for delivery.&nbsp; Only
mail for jane.podunk.xx or any hosts you don't see above will be sent to
the MX.&nbsp; For most Internet sites, wildcard MX records are not useful.&nbsp;
You need to put explicit MX records on every host.
<P>Wildcard MXs can be bad, because they make some operations succeed when
they should fail instead.&nbsp; Consider the case where someone in the
domain "widget.com" tries to send mail to "joe@larry".&nbsp; If the host
"larry" doesn't actually exist, the mail should in fact bounce immediately.&nbsp;
But because of domain searching the address gets resolved to "larry.widget.com",
and because of the wildcard MX this is a valid address according to DNS.&nbsp;
Or perhaps someone simply made a typo in the hostname portion of the address.&nbsp;
The mail message then gets routed to the mail host, which then rejects
the mail with strange error messages like "I refuse to talk to myself"
or "Local configuration error".
<P>Wildcard MX records are good for when you have a large number of hosts
which are not directly Internet-connected (for example, behind a firewall)
and for administrative or political reasons it is too difficult to have
individual MX records for every host, or to force all e-mail addresses
to be "hidden" behind one or more domain names. In that case, you must
divide your DNS into two parts, an internal DNS, and an external DNS.&nbsp;
The external DNS will have only a few hosts and explicit MX records, and
one or more wildcard MXs for each internal domain.&nbsp; Internally the
DNS will be complete, with all explicit MX records and no wildcards.
<P>Wildcard As and CNAMEs are possible too, and are really confusing to
users, and a potential nightmare if used without thinking first.&nbsp;
It could result (due again to domain searching) in any telnet/ftp attempts
from within the domain to unknown hosts to be directed to one address.&nbsp;
One such wildcard CNAME (in *.edu.com) caused Internet-wide loss of services
and potential security nightmares due to unexpected interactions with domain
searching.&nbsp; It resulted in swift fixes, and even an RFC ([<A HREF="ftp://ftp.is.co.za/rfc/rfc1535.txt">RFC
1535</A>]) documenting the problem.
<BR>&nbsp;
<H3>
<A NAME="2.8 Authority"></A>2.8 Authority and Delegation Errors (NS records)</H3>
You are required to have at least two nameservers for every domain, though
more is preferred.&nbsp; Have secondaries outside your network.&nbsp; If
the secondary isn't under your control, periodically check up on them and
make sure they're getting current zone data from you.&nbsp; Queries to
their nameserver about your hosts should always result in an "authoritative"
response.&nbsp; If not, this is called a "lame delegation".&nbsp; A lame
delegations exists when a nameserver is delegated responsibility for providing
nameservice for a zone (via NS records) but is not performing nameservice
for that zone (usually because it is not set up as a primary or secondary
for the zone).
<P>The "classic" lame delegation can be illustrated in this example:
<BR>&nbsp;
<BR>&nbsp;
<CENTER><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0 COLS=4 WIDTH="75%" >
<TR>
<TD>podunk.xx.</TD>

<TD>IN</TD>

<TD>NS</TD>

<TD>ns1.podunk.xx.</TD>
</TR>

<TR>
<TD></TD>

<TD>IN</TD>

<TD>NS</TD>

<TD>ns0.widget.com.</TD>
</TR>
</TABLE></CENTER>

<P>"podunk.xx" is a new domain which has recently been created, and "ns1.podunk.xx"
has been set up to perform nameservice for the zone. They haven't quite
finished everything yet and haven't made sure that the hostmaster at "ns0.widget.com"
has set up to be a proper secondary, and thus has no information about
the podunk.xx domain, even though the DNS says it is supposed to.&nbsp;
Various things can happen depending on which nameserver is used.&nbsp;
At best, extra DNS traffic will result from a lame delegation.&nbsp; At
worst, you can get unresolved hosts and bounced e-mail.
<P>Also, sometimes a nameserver is moved to another host or removed from
the list of secondaries.&nbsp; Unfortunately due to caching of NS records,
many sites will still think that a host is a secondary after that host
has stopped providing nameservice.&nbsp; In order to prevent lame delegations
while the cache is being aged, continue to provide nameservice on the old
nameserver for the length of the maximum of the minimum plus refresh times
for the zone and the parent zone. (See section 2.2)
<P>Whenever a primary or secondary is removed or changed, it takes a fair
amount of human coordination among the parties involved.&nbsp; (The site
itself, it's parent, and the site hosting the secondary)&nbsp; When a primary
moves, make sure all secondaries have their named.boot files updated and
their servers reloaded.&nbsp; When a secondary moves, make sure the address
records at both the primary and parent level are changed.
<P>It's also been reported that some distant sites like to pick popular
nameservers like "ns.uu.net" and just add it to their list of NS records
in hopes that they will magically perform additional nameservice for them.&nbsp;
This is an even worse form of lame delegation, since this adds traffic
to an already busy nameserver.&nbsp; Please contact the hostmasters of
sites which have lame delegations. Various tools can be used to detect
or actively find lame delegations.&nbsp; See the list of contributed software
in the BIND distribution.
<P>Make sure your parent domain has the same NS records for your zone as
you do.&nbsp; (Don't forget your in-addr.arpa zones too!).&nbsp; Do not
list too many (7 is the recommended maximum), as this just makes things
harder to manage and is only really necessary for very popular top-level
or root zones.&nbsp; You also run the risk of overflowing the 512-byte
limit of a UDP packet in the response to an NS query.&nbsp; If this happens,
resolvers will "fall back" to using TCP requests, resulting in increased
load on your nameserver.
<P>It's important when picking geographic locations for secondary nameservers
to minimize latency as well as increase reliability. Keep in mind network
topologies.&nbsp; For example if your site is on the other end of a slow
local or international link, consider a secondary on the other side of
the link to decrease average latency.&nbsp; Contact your Internet service
provider or parent domain contact for more information about secondaries
which may be available to you.
<BR>&nbsp;
<H2>
<A NAME="3. BIND"></A>3. BIND Operation</H2>
This section discusses common problems people have in the actual operation
of the nameserver (specifically, BIND).&nbsp; Not only must the data be
correct as explained above, but the nameserver must be operated correctly
for the data to be made available.
<BR>&nbsp;
<H3>
<A NAME="3.1 Serial"></A>3.1 Serial numbers</H3>
Each zone has a serial number associated with it.&nbsp; Its use is for
keeping track of who has the most current data.&nbsp; If and only if the
primary's serial number of the zone is greater will the secondary ask the
primary for a copy of the new zone data (see special case below).
<P>Don't forget to change the serial number when you change data!&nbsp;
If you don't, your secondaries will not transfer the new zone information.&nbsp;
Automating the incrementing of the serial number with software is also
a good idea.
<P>If you make a mistake and increment the serial number too high, and
you want to reset the serial number to a lower value, use the following
procedure:
<UL>Take the `incorrect' serial number and add 2147483647 to it.&nbsp;
If&nbsp; the number exceeds 4294967296, subtract 4294967296.&nbsp; Load
the resulting number.&nbsp; Then wait 2 refresh periods to allow the zone
to propagate to all servers.
<P>Repeat above until the resulting serial number is less than the target
serial number.
<P>Up the serial number to the target serial number.</UL>
This procedure won't work if one of your secondaries is running an old
version of BIND (4.8.3 or earlier).&nbsp; In this case you'll have to contact
the hostmaster for that secondary and have them kill the secondary servers,
remove the saved backup file, and restart the server.&nbsp; Be careful
when editing the serial number - DNS admins don't like to kill and restart
nameservers because you lose all that cached data.
<BR>&nbsp;
<H3>
<A NAME="3.2 Zone file style"></A>3.2 Zone file style guide</H3>
Here are some useful tips in structuring your zone files.&nbsp; Following
these will help you spot mistakes, and avoid making more.
<P>Be consistent with the style of entries in your DNS files. If your $ORIGIN
is podunk.xx., try not to write entries like:
<BR>&nbsp;
<BR>&nbsp;
<CENTER><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0 COLS=4 WIDTH="75%" >
<TR>
<TD>mary</TD>

<TD>IN</TD>

<TD>A</TD>

<TD>1.2.3.1</TD>
</TR>

<TR>
<TD>sue.podunk.xx.</TD>

<TD>IN</TD>

<TD>A</TD>

<TD>1.2.3.4</TD>
</TR>
</TABLE></CENTER>
or:
<BR>&nbsp;
<CENTER><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0 COLS=4 WIDTH="75%" >
<TR>
<TD>bobbi</TD>

<TD>IN</TD>

<TD>A</TD>

<TD>1.2.3.2</TD>
</TR>

<TR>
<TD></TD>

<TD>IN</TD>

<TD>MX</TD>

<TD>mary.podunk.xx.</TD>
</TR>
</TABLE></CENTER>

<P>Either use all FQDNs (Fully Qualified Domain Names) everywhere or used
unqualified names everywhere.&nbsp; Or have FQDNs all on the right-hand
side but unqualified names on the left.&nbsp; Above all, be consistent.
<P>Use tabs between fields, and try to keep columns lined up.&nbsp; It
makes it easier to spot missing fields (note some fields such as "IN" are
inherited from the previous record and may be left out in certain circumstances.)
<P>Remember you don't need to repeat the name of the host when you are
defining multiple records for one host.&nbsp; Be sure also to keep all
records associated with a host together in the file.&nbsp; It will make
things more straightforward when it comes time to remove or rename a host.
<P>Always remember your $ORIGIN.&nbsp; If you don't put a `.' at the end
of an FQDN, it's not recognized as an FQDN.&nbsp; If it is not an FQDN,
then the nameserver will append $ORIGIN to the name.&nbsp; Double check,
triple check, those trailing dots, especially in in-addr.arpa zone files,
where they are needed the most.
<P>Be careful with the syntax of the SOA and WKS records (the records which
use parentheses).&nbsp; BIND is not very flexible in how it parses these
records.&nbsp; See the documentation for BIND.
<BR>&nbsp;
<H3>
<A NAME="3.3 Verifying"></A>3.3 Verifying data</H3>
Verify the data you just entered or changed by querying the resolver with
dig (or your favorite DNS tool, many are included in the BIND distribution)
after a change.&nbsp; A few seconds spent double checking can save hours
of trouble, lost mail, and general headaches.&nbsp; Also be sure to check
syslog output when you reload the nameserver.&nbsp; If you have grievous
errors in your DNS data or boot file, named will report it via syslog.
<P>It is also highly recommended that you automate this checking, either
with software which runs sanity checks on the data files before they are
loaded into the nameserver, or with software which checks the data already
loaded in the nameserver.&nbsp; Some contributed software to do this is
included in the BIND distribution.
<BR>&nbsp;
<H2>
<A NAME="4. Miscellaneous"></A>4. Miscellaneous Topics</H2>

<H3>
<A NAME="4.1 Boot file"></A>4.1 Boot file setup</H3>
Certain zones should always be present in nameserver configurations:
<BR>&nbsp;
<BR>&nbsp;
<CENTER><TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0 COLS=3 WIDTH="75%" >
<TR>
<TD>primary</TD>

<TD>localhost</TD>

<TD>localhost</TD>
</TR>

<TR>
<TD>primary</TD>

<TD>0.0.127.in-addr.arpa</TD>

<TD>127.0</TD>
</TR>

<TR>
<TD>primary</TD>

<TD>255.in-addr.arpa</TD>

<TD>255</TD>
</TR>

<TR>
<TD>primary</TD>

<TD>0.in-addr.arpa</TD>

<TD>0</TD>
</TR>
</TABLE></CENTER>

<P>These are set up to either provide nameservice for "special" addresses,
or to help eliminate accidental queries for broadcast or local address
to be sent off to the root nameservers.&nbsp; All of these files will contain
NS and SOA records just like the other zone files you maintain, the exception
being that you can probably make the SOA timers very long, since this data
will never change.
<P>The "localhost" address is a "special" address which always refers to
the local host.&nbsp; It should contain the following line:
<UL>localhost.&nbsp;&nbsp;&nbsp; IN&nbsp;&nbsp;&nbsp; A&nbsp;&nbsp;&nbsp;
127.0.0.1</UL>
The "127.0" file should contain the line:
<UL>1&nbsp;&nbsp;&nbsp; PTR&nbsp;&nbsp;&nbsp; localhost.</UL>
There has been some extensive discussion about whether or not to append
the local domain to it.&nbsp; The conclusion is that "localhost." would
be the best solution.&nbsp; The reasons given include:
<UL>"localhost" by itself is used and expected to work in some systems.
<P>Translating 127.0.0.1 into "localhost.dom.ain" can cause some software
to connect back to the loopback interface when it didn't want to because
"localhost" is not equal to "localhost.dom.ain".</UL>
The "255" and "0" files should not contain any additional data beyond the
NS and SOA records.
<P>Note that future BIND versions may include all or some of this data
automatically without additional configuration.
<BR>&nbsp;
<H3>
<A NAME="4.2 Other Resolver"></A>4.2 Other Resolver and Server bugs</H3>
Very old versions of the DNS resolver have a bug that cause queries for
names that look like IP addresses to go out, because the user supplied
an IP address and the software didn't realize that it didn't&nbsp; need
to be resolved.&nbsp; This has been fixed but occasionally it still pops
up.&nbsp; It's important because this bug means that these queries will
be sent directly to the root nameservers, adding to an already heavy DNS
load.
<P>While running a secondary nameserver off another secondary nameserver&nbsp;
is possible, it is not recommended unless necessary due to network topologies.&nbsp;
There are known cases where it has led to problems like bogus TTL values.&nbsp;
While this may be caused by older or flawed DNS implementations, you should
not chain secondaries off of one another since this builds up additional
reliability dependencies as well as adds additional delays in updates of
new zone data.
<BR>&nbsp;
<H3>
<A NAME="4.3 Server"></A>4.3 Server issues</H3>
DNS operates primarily via UDP (User Datagram Protocol) messages. Some
UNIX operating systems, in an effort to save CPU cycles, run with UDP checksums
turned off.&nbsp; The relative merits of this have long&nbsp; been debated.&nbsp;
However, with the increase in CPU speeds, the&nbsp; performance considerations
become less and less important.&nbsp; It is strongly encouraged that you
turn on UDP checksumming to avoid corrupted data not only with DNS but
with other services that use UDP (like NFS).&nbsp; Check with your operating
system documentation to verify&nbsp; that UDP checksumming is enabled.
<BR>&nbsp;
<H2>
<A NAME="References"></A>References</H2>
&nbsp;
<TABLE BORDER=0 CELLSPACING=0 CELLPADDING=0 COLS=2 WIDTH="100%" >
<TR ALIGN=LEFT VALIGN=TOP>
<TD WIDTH="10%">[<A HREF="ftp://ftp.is.co.za/rfc/rfc974.txt">RFC 974</A>]</TD>

<TD>Partridge, C., "Mail routing and the domain system", STD 14, RFC 974,
CSNET CIC BBN Laboratories Inc, January 1986.&nbsp;</TD>
</TR>

<TR ALIGN=LEFT VALIGN=TOP>
<TD>[<A HREF="ftp://ftp.is.co.za/rfc/rfc1033.txt">RFC 1033</A>]</TD>

<TD>Lottor, M, "Domain Administrators Operations Guide", RFC 1033, USC/Information
Sciences Institute, November 1987.&nbsp;</TD>
</TR>

<TR ALIGN=LEFT VALIGN=TOP>
<TD>[<A HREF="ftp://ftp.is.co.za/rfc/rfc1034.txt">RFC 1034</A>]</TD>

<TD>Mockapetris, P., "Domain Names - Concepts and Facilities", STD 13,
RFC 1034, USC/Information Sciences Institute, November 1987.&nbsp;</TD>
</TR>

<TR ALIGN=LEFT VALIGN=TOP>
<TD>[<A HREF="rfc1035/rfc1035.html">RFC 1035</A>]</TD>

<TD>Mockapetris, P., "Domain Names - Implementation and Specification",
STD 13, RFC 1035, USC /Information Sciences Institute, November 1987.&nbsp;</TD>
</TR>

<TR ALIGN=LEFT VALIGN=TOP>
<TD>[<A HREF="ftp://ftp.is.co.za/rfc/rfc1123.txt">RFC 1123</A>]</TD>

<TD>Braden, R., "Requirements for Internet Hosts - Application and Support",
STD 3, RFC 1123, IETF, October 1989.&nbsp;</TD>
</TR>

<TR ALIGN=LEFT VALIGN=TOP>
<TD>[<A HREF="ftp://ftp.is.co.za/rfc/rfc1178.txt">RFC 1178</A>]</TD>

<TD>Libes, D., "Choosing a Name for Your Computer", FYI 5, RFC 1178, Integrated
Systems Group/NIST, August 1990.&nbsp;</TD>
</TR>

<TR ALIGN=LEFT VALIGN=TOP>
<TD>[<A HREF="ftp://ftp.is.co.za/rfc/rfc1183.txt">RFC 1183</A>]</TD>

<TD>Ullman, R., Mockapetris, P., Mamakos, L, and C. Everhart, "New DNS
RR Definitions", RFC 1183, October 1990.&nbsp;</TD>
</TR>

<TR ALIGN=LEFT VALIGN=TOP>
<TD>[<A HREF="ftp://ftp.is.co.za/rfc/rfc1535.txt">RFC 1535</A>]</TD>

<TD>Gavron, E., "A Security Problem and Proposed Correction With Widely
Deployed DNS Software", RFC 1535, ACES Research Inc., October 1993.&nbsp;</TD>
</TR>

<TR ALIGN=LEFT VALIGN=TOP>
<TD>[<A HREF="ftp://ftp.is.co.za/rfc/rfc1536.txt">RFC 1536</A>]</TD>

<TD>Kumar, A., Postel, J., Neuman, C., Danzig, P., and S. Miller, "Common
DNS Implementation Errors and Suggested Fixes", RFC 1536, USC/Information
Sciences Institute, USC, October 1993.&nbsp;</TD>
</TR>

<TR ALIGN=LEFT VALIGN=TOP>
<TD>[<A HREF="ftp://ftp.is.co.za/rfc/rfc1537.txt">RFC 1537</A>]</TD>

<TD>Beertema, P., "Common DNS Data File Configuration Errors", RFC 1537,
CWI, October 1993.&nbsp;</TD>
</TR>

<TR ALIGN=LEFT VALIGN=TOP>
<TD>[<A HREF="rfc1713.html">RFC 1713</A>]</TD>

<TD>A. Romao, "Tools for DNS debugging", RFC 1713, FCCN, November 1994.&nbsp;</TD>
</TR>

<TR>
<TD>[BOG]</TD>

<TD>Vixie, P, et. al., "Name Server Operations Guide for BIND", Vixie Enterprises,
July 1994</TD>
</TR>
</TABLE>

<BR>&nbsp;
<H2>
<A NAME="5. Security"></A>5. Security Considerations</H2>
Security issues are not discussed in this memo.
<BR>&nbsp;
<H2>
<A NAME="6. Author"></A>6. Author's Address</H2>
David Barr
<BR>The Pennsylvania State University
<BR>Department of Mathematics
<BR>334 Whitmore Building
<BR>University Park, PA 16802
<P>Voice: +1 814 863 7374
<BR>Fax: +1 814 863-8311
<BR>EMail: <A HREF="mailto:barr@math.psu.edu">barr@math.psu.edu</A>
</BODY>
</HTML>
